# Build Scripts

This directory contains build scripts for the nwep Node.js native bindings.

## Overview

The nwep package builds from source on installation, eliminating the need for pre-built binaries and platform-specific CI/CD pipelines.

## Requirements

- **Rust** 1.85+ (install from [rustup.rs](https://rustup.rs/))
- **Node.js** 12.22+ / 14.17+ / 15.12+ / 16.0+
- **Build tools**:
  - Linux: `build-essential`, `cmake`, `perl`
  - macOS: Xcode Command Line Tools
  - Windows: Visual Studio Build Tools or MinGW-w64

## Usage

### Manual Build

```bash
npm run build
```

### Automatic Build

The package will automatically build when installed:

```bash
npm install
# or
yarn install
```

### Debug Build

```bash
npm run build:debug
```

## How It Works

1. **build.js** - Main build script that:
   - Detects the current platform and architecture
   - Checks for Rust installation
   - Runs `napi build` with the appropriate flags
   - Provides clear error messages if requirements are missing

2. **postinstall hook** - Automatically runs `build.js` after `npm install`

3. **Platform detection** - The script uses Node.js `os.platform()` and `os.arch()` to determine the target platform

## Supported Platforms

The build script will automatically build for your current platform:

- **Linux**: x64, ARM64, ARMv7
- **macOS**: x64 (Intel), ARM64 (Apple Silicon)
- **Windows**: x64, x86, ARM64
- **FreeBSD**: x64
- **Android**: ARM64, ARMv7

## Troubleshooting

### "Rust is not installed"

Install Rust:
```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

### "Build failed" with linker errors

Make sure you have the required build tools:

**Linux:**
```bash
sudo apt-get install build-essential cmake perl
```

**macOS:**
```bash
xcode-select --install
```

**Windows:**
Install [Visual Studio Build Tools](https://visualstudio.microsoft.com/downloads/#build-tools-for-visual-studio-2022)

## Development

To modify the build process, edit `scripts/build.js`.

The build uses [@napi-rs/cli](https://napi.rs/) which provides:
- Automatic platform detection
- Rust/Node.js bridge generation
- TypeScript type definitions
